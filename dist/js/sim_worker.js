importScripts("./magesim.js"),onmessage=function(n){var t=n.data;"start"==t.type&&fetch("./magesim.wasm",{cache:"no-store"}).then((function(n){return n.arrayBuffer()})).then((function(n){return MageSim({wasmBinary:n})})).then((function(n){return n.ready})).then((function(n){var i=n.allocConfig();for(var o in t.config)"timings"!=o&&void 0!==i[o]&&(i[o]=t.config[o]);n.Rotation.values.hasOwnProperty(t.config.rotation)&&(i.rotation=n.Rotation.values[t.config.rotation]),n.Trinket.values.hasOwnProperty(t.config.trinket1)&&(i.trinket1=n.Trinket.values[t.config.trinket1]),n.Trinket.values.hasOwnProperty(t.config.trinket2)&&(i.trinket2=n.Trinket.values[t.config.trinket2]),n.MetaGem.values.hasOwnProperty(t.config.meta_gem)&&(i.meta_gem=n.MetaGem.values[t.config.meta_gem]),n.Potion.values.hasOwnProperty(t.config.potion)&&(i.potion=n.Potion.values[t.config.potion]),n.Potion.values.hasOwnProperty(t.config.pre_potion)&&(i.pre_potion=n.Potion.values[t.config.pre_potion]),n.Conjured.values.hasOwnProperty(t.config.conjured)&&(i.conjured=n.Conjured.values[t.config.conjured]);for(var e=0;e<t.config.timings.length;e++)n.addTiming(i,t.config.timings[e].name,t.config.timings[e].t?t.config.timings[e].t:0,t.config.timings[e].wait_for_buff,t.config.timings[e].wait_t?t.config.timings[e].wait_t:0);for(e=0;e<t.config.interruptions.length;e++)n.addInterruption(i,t.config.interruptions[e].silence,t.config.interruptions[e].affects_all,t.config.interruptions[e].t,t.config.interruptions[e].duration);var r=n.allocPlayer(i);n.Race.values.hasOwnProperty(t.config.race)&&(r.race=n.Race.values[t.config.race]);var a=JSON.parse(JSON.stringify(r.getStats()));for(var o in t.config.stats)a.hasOwnProperty(o)&&(a[o]=t.config.stats[o]);r.setStats(a);var s=JSON.parse(JSON.stringify(r.getTalents()));for(var o in t.config.talents)s.hasOwnProperty(o)&&(s[o]=t.config.talents[o]);r.setTalents(s);var g=JSON.parse(JSON.stringify(r.getGlyphs()));for(var o in t.config.glyphs)g.hasOwnProperty(o)&&(g[o]=t.config.glyphs[o]);if(r.setGlyphs(g),t.iterations&&t.iterations>1)var c=n.runSimulations(i,r,t.iterations);else c=n.runSimulation(i,r);c.log&&(c.log=JSON.parse(c.log)),c.spells&&(c.spells=JSON.parse(c.spells)),c.histogram&&(c.histogram=JSON.parse(c.histogram)),postMessage({type:"success",result:c})})).catch((function(n){return console.error(n)}))};