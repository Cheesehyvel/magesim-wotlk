importScripts("./magesim.js"),onmessage=function(t){var n=t.data;"start"==n.type&&fetch("./magesim.wasm",{cache:"no-store"}).then((function(t){return t.arrayBuffer()})).then((function(t){return MageSim({wasmBinary:t})})).then((function(t){return t.ready})).then((function(t){var i=t.allocConfig();for(var e in n.config)"timings"!=e&&void 0!==i[e]&&(i[e]=n.config[e]);t.Rotation.values.hasOwnProperty(n.config.rotation)&&(i.rotation=t.Rotation.values[n.config.rotation]),t.Trinket.values.hasOwnProperty(n.config.trinket1)&&(i.trinket1=t.Trinket.values[n.config.trinket1]),t.Trinket.values.hasOwnProperty(n.config.trinket2)&&(i.trinket2=t.Trinket.values[n.config.trinket2]),t.MetaGem.values.hasOwnProperty(n.config.meta_gem)&&(i.meta_gem=t.MetaGem.values[n.config.meta_gem]),t.Potion.values.hasOwnProperty(n.config.potion)&&(i.potion=t.Potion.values[n.config.potion]),t.Potion.values.hasOwnProperty(n.config.pre_potion)&&(i.pre_potion=t.Potion.values[n.config.pre_potion]),t.Conjured.values.hasOwnProperty(n.config.conjured)&&(i.conjured=t.Conjured.values[n.config.conjured]);for(var o=0;o<n.config.timings.length;o++)t.addTiming(i,n.config.timings[o].name,n.config.timings[o].t?n.config.timings[o].t:0,n.config.timings[o].wait_for_buff,n.config.timings[o].wait_t?n.config.timings[o].wait_t:0);var r=t.allocPlayer(i);t.Race.values.hasOwnProperty(n.config.race)&&(r.race=t.Race.values[n.config.race]);var a=JSON.parse(JSON.stringify(r.getStats()));for(var e in n.config.stats)a.hasOwnProperty(e)&&(a[e]=n.config.stats[e]);r.setStats(a);var s=JSON.parse(JSON.stringify(r.getTalents()));for(var e in n.config.talents)s.hasOwnProperty(e)&&(s[e]=n.config.talents[e]);r.setTalents(s);var g=JSON.parse(JSON.stringify(r.getGlyphs()));for(var e in n.config.glyphs)g.hasOwnProperty(e)&&(g[e]=n.config.glyphs[e]);if(r.setGlyphs(g),n.iterations&&n.iterations>1)var c=t.runSimulations(i,r,n.iterations);else c=t.runSimulation(i,r);c.log&&(c.log=JSON.parse(c.log)),c.spells&&(c.spells=JSON.parse(c.spells)),c.histogram&&(c.histogram=JSON.parse(c.histogram)),postMessage({type:"success",result:c})})).catch((function(t){return console.error(t)}))};